263. Yandex Cells

(sorry, some words duplicated ;( )

Команда Яндекс.devtools разрабатывает редактор таблиц. Вам поручили написать модуль, обрабатывающий запросы объединения и разделения ячеек.

Таблица состоит из rowrow строк, пронумерованных от 11 до rowrow, и colcol столбцов, пронумерованных от 11 до colcol. Назовём \textit{элементарной ячейкой} область таблицы, находящуюся на пересечении некоторой строки и некоторого столбца. Каждая элементарная ячейка однозначно задаётся парой координат (x,y)(x,y), где xx — номер строки, в которой находится элементарная ячейка, а yy — номер столбца, в которой находится элементарная ячейка. В каждый момент времени таблица разбита на непересекающиеся \textit{ячейки}. Ячейкой является непустая прямоугольная область таблицы, образованная объединением некоторого множества элементарных ячеек. Более формально любая ячейка задаётся четвёркой чисел (lx,rx,ly,ry)(lx​,rx​,ly​,ry​) и состоит из объединения всех элементарных ячеек с координатами (x,y)(x,y) такими, что lx≤x≤rxlx​≤x≤rx​ и ly≤y≤ryly​≤y≤ry​.

Для удобства работы с таблицами для каждой таблицы существует её ASCII-представление. ASCII-представление таблицы состоит из символов -, |, + и пробела. Для каждой строки фиксируется высота hihi​, а для каждого столбца фиксируется ширина wiwi​. ASCII-представлением таблицы является матрица из символов с mrow=(∑i=1rowhi)+row+1mrow​=(∑i=1row​hi​)+row+1 строками, пронумерованными от 11 до mrowmrow​, и mcol=(∑i=1colwi)+col+1mcol​=(∑i=1col​wi​)+col+1 столбцами, пронумерованными от 11 до mcolmcol​. Ячейке, заданной четвёркой чисел lx,rx,ly,rylx​,rx​,ly​,ry​, соответствует подматрица матрицы символов, состоящая из символов с координатами (p,q)(p,q) такими, что (∑i=1lx−1hi)+lx+1≤p≤(∑i=1rxhi)+rx(∑i=1lx​−1​hi​)+lx​+1≤p≤(∑i=1rx​​hi​)+rx​ и (∑i=1ly−1wi)+ly+1≤q≤(∑i=1rywi)+ry(∑i=1ly​−1​wi​)+ly​+1≤q≤(∑i=1ry​​wi​)+ry​.

Назовём элемент матрицы с координатами (p,q)(p,q) горизонтальным разделителем, если выполнено одно из следующих условий:

    Хотя бы один из элементов (p,q−1)(p,q−1), (p,q+1)(p,q+1) не существует (то есть q−1=0q−1=0 или q+1=mcol+1q+1=mcol​+1).
    Элементы (p,q−1)(p,q−1) и (p,q+1)(p,q+1) существуют и принадлежат различным ячейкам.

Назовём элемент матрицы с координатами (p,q)(p,q) вертикальным разделителем, если выполнено одно из следующих условий:

    Хотя бы один из элементов (p−1,q)(p−1,q), (p+1,q)(p+1,q) не существует (то есть p−1=0p−1=0 или p+1=mrow+1p+1=mrow​+1).
    Элементы (p−1,q)(p−1,q) и (p+1,q)(p+1,q) существуют и принадлежат различным ячейкам.

Назовём элемент матрицы с координатами (p,q)(p,q) \textit{крестообразным разделителем}, если он не принадлежит ни одной ячейке и среди четырёх элементов (p−1,q)(p−1,q), (p,q−1)(p,q−1), (p+1,q)(p+1,q) и (p,q+1)(p,q+1) найдётся хотя бы один горизонтальный и вертикальный разделитель.

Символ, соответствующий элементу матрицы с координатами (p,q)(p,q), определяется следующими правилами:

    Если элемент матрицы принадлежит некоторой ячейке, то он обозначается пробелом.
    Если элемент матрицы является горизонтальным разделителем, но не является крестообразным разделителем, то он обозначается символом |.
    Если элемент матрицы является вертикальным разделителем, но не является крестообразным разделителем, то он обозначается символом -.
    Если элемент матрицы является крестообразным разделителем, то он обозначается символом +.

На вход модуль принимает ASCII-описание таблицы. Некоторые клетки уже могут быть объединены.

Затем к модулю поступает qq запросов одного из двух типов:

    split pos — разделить объединенную ячейку, содержащую элементарную ячейку с координатой pos на элементарные ячейки.
        Если ячейка с координатой pos элементарная, то модуль должен вывести Can not split elementary cell
        Иначе модуль должен разделить данную ячейку на элементарные и вывести Split onto NUM cells, где NUM — количество образованных элементарных ячеек.

    merge pos1 pos2 — объединить ячейки, содержащие элементарные ячейки с координатами pos1 и pos2 соответственно
        Если данные элементарные ячейки содержатся в одной и той же объединенной ячейке, то модуль должен вывести Can not merge cell with itself
        Иначе если эти объединенные ячейки выровнены горизонтально (левая граница одной ячейки полностью совпадает с правой границей другой ячейки), то модуль должен объединить их и вывести Merged horizontally-aligned cells
        Иначе если эти объединенные ячейки выровнены вертикально (нижняя граница одной ячейки полностью совпадает с верхней границей другой ячейки), то модуль должен объединить их и вывести Merged vertically-aligned cells
        Иначе модуль должен вывести Can not merge unaligned cells

После вывода статуса каждого запроса который изменил таблицу модуль должен вывести и полученную таблицу.
Формат ввода

Первая строка содержит два целых числа mrowmrow​ и mcolmcol​ (3≤mrow,mcol3≤mrow​,mcol​; mrow×mcol≤104mrow​×mcol​≤104) — количество строк и столбцов, задающих ASCII-описание таблицы.

Следующие mrowmrow​ строк содержат по mcolmcol​ символов каждый и задают ASCII-описание таблицы.

Следующая строка содержит целое число rowrow (1≤row≤⌊mrow−12⌋1≤row≤⌊2mrow​−1​⌋) — количество строк таблицы.

Следующая строка содержит rowrow целых чисел hihi​ (1≤hi1≤hi​; ∑i=1rowhi+row+1=mrow∑i=1row​hi​+row+1=mrow​) — высоты строк таблицы.

Следующая строка содержит целое число colcol (1≤m≤⌊mcol−12⌋1≤m≤⌊2mcol​−1​⌋) — количество столбцов таблицы.

Следующая строка содержит colcol целых чисел wiwi​ (1≤wi1≤wi​; ∑i=1colwi+col+1=mcol∑i=1col​wi​+col+1=mcol​) — ширины столбцов таблицы.

Следующая строка содержит целое число qq (1≤q≤1031≤q≤103) — количество запросов к модулю.

Следующие qq строк содержат запросы к модулю в формате, указанном выше.

Координаты ячейки cc описываются как colcrowccolc​rowc​, где rowcrowc​ — номер строки (1≤rowc≤row1≤rowc​≤row), а colccolc​ — номер столбца, столбцы нумеруются так:
A, B, C, …, Z, AA, AB, AC, …, AZ, BA, …, AAA, AAB, …A, B, C, …, Z, AA, AB, AC, …, AZ, BA, …, AAA, AAB, …
Формат вывода

Для каждого запроса выведите его статус и в случае его успешного завершения таблицу, получившуюся в результате применения этого запроса.

[Решение](solution.cpp)
